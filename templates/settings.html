{% extends base_template %}
{% block content %}
<div id="top"></div>
<div class="hero p-3 rounded-4 mb-3">
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
    <div>
      <p class="text-secondary mb-1">Ayarlar merkezi</p>
      <h2 class="mb-0">Ayarlar</h2>
    </div>
    <div class="small text-secondary">Güvenlik, otomasyon, bildirimler, veri saklama</div>
  </div>
</div>

<div class="card mb-3"><div class="card-body">
  <h6 class="mb-1">Bu sayfa ne işe yarar?</h6>
  <div class="small text-secondary">
    Güvenlik modunu (SAFE MODE), pompa/ısıtıcı limitlerini, otomasyon kurallarını ve bildirim/veri saklama ayarlarını buradan yönetirsin.
    Admin Token gerekiyorsa ilk kutudan gir. Detay: <a href="/help#hAyarlar">Yardım/SSS</a>.
  </div>
</div></div>

<div class="card mb-3">
  <div class="card-body">
  <h6 class="mb-2">Özet</h6>
    <div class="row g-2">
      <div class="col-md-4">
        <div class="small text-secondary">SAFE MODE</div>
        <div id="settingsSummarySafeMode" class="fw-semibold">--</div>
      </div>
      <div class="col-md-4">
        <div class="small text-secondary">Otomasyon</div>
        <div id="settingsSummaryAutomation" class="fw-semibold">--</div>
      </div>
      <div class="col-md-4">
        <div class="small text-secondary">Aktif Müdahale</div>
        <div id="settingsSummaryOverride" class="fw-semibold">--</div>
      </div>
      <div class="col-md-4">
        <div class="small text-secondary">Pompa Günlük Kullanım</div>
        <div id="settingsSummaryPumpUsage" class="fw-semibold">--</div>
      </div>
      <div class="col-md-4">
        <div class="small text-secondary">Bildirimler</div>
        <div id="settingsSummaryNotifications" class="fw-semibold">--</div>
      </div>
      <div class="col-md-4">
        <div class="small text-secondary">Veri Saklama</div>
        <div id="settingsSummaryRetention" class="fw-semibold">--</div>
      </div>
    </div>
  </div>
</div>

<div class="card mb-3"><div class="card-body">
  <h6>Admin Erişimi</h6>
  <p class="text-secondary small">ADMIN_TOKEN tanımlıysa buraya gir. Tarayıcıda saklanır. Token yoksa admin işlemleri sadece yerel ağdan çalışır.</p>
  <div class="row g-2 align-items-end">
    <div class="col-md-6">
      <label class="form-label">Admin Token</label>
      <input class="form-control" id="adminTokenInput" type="password" placeholder="PIN / Token">
    </div>
  </div>
  <small class="text-secondary" id="adminTokenStatus">Durum: --</small>
</div></div>

<div class="row g-3">
  <div class="col-md-6">
    <div class="card h-100" id="secSafeMode"><div class="card-body">
      <h6>Güvenlik Modu (SAFE MODE)</h6>
      <p class="text-secondary small">SAFE MODE açıkken kontrol endpointleri kilitli, sadece izleme yapılır.</p>
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" role="switch" id="safeModeToggle">
        <label class="form-check-label" for="safeModeToggle">
          SAFE MODE aktif
          <span class="info-icon" data-bs-toggle="tooltip" title="Açıkken röle kontrolü ve otomasyon komutları kilitlenir. Sadece izleme yapılır.">?</span>
        </label>
      </div>
    </div></div>
  </div>
  <div class="col-md-6">
    <div class="card h-100" id="secLimits"><div class="card-body">
      <h6>Pompa/Isıtıcı Limitleri</h6>
      <div class="row g-2">
        <div class="col-12">
          <label class="form-label">Pompa Max Saniye
            <span class="info-icon" data-bs-toggle="tooltip" title="Tek seferde pompanın çalışabileceği maksimum süre. Güvenlik için kısa tut.">?</span>
          </label>
          <input class="form-control" id="pumpMax" type="number" min="1" value="15">
        </div>
        <div class="col-12">
          <label class="form-label">Pompa Cooldown (s)
            <span class="info-icon" data-bs-toggle="tooltip" title="Pompa kapandıktan sonra yeniden çalıştırılmadan önce beklenmesi gereken süre.">?</span>
          </label>
          <input class="form-control" id="pumpCooldown" type="number" min="1" value="60">
        </div>
        <div class="col-12">
          <label class="form-label">Isıtıcı Max (s)
            <span class="info-icon" data-bs-toggle="tooltip" title="Isıtıcının tek seferde çalışabileceği en uzun süre.">?</span>
          </label>
          <input class="form-control" id="heaterMax" type="number" min="30" value="300">
        </div>
        <div class="col-12">
          <label class="form-label">Isıtıcı Üst Limit (C)
            <span class="info-icon" data-bs-toggle="tooltip" title="Bu sıcaklıkta ısıtıcı zorla kapatılır. 0 ise devre dışı.">?</span>
          </label>
          <input class="form-control" id="heaterCutoff" type="number" min="0" step="0.1" value="30">
          <div class="form-text">0 devre dışı</div>
        </div>
      </div>
    </div></div>
  </div>
</div>

<div class="d-flex justify-content-between align-items-center mb-3">
  <small class="text-secondary" id="settingsSavedNote"></small>
  <button class="btn btn-primary" id="saveSettings" type="button">Kaydet</button>
</div>

<div class="card mb-3"><div class="card-body">
  <label class="form-label">Hızlı Geçiş</label>
  <select class="form-select" id="settingsSectionJump">
    <option value="" selected>Seç...</option>
    <option value="secSafeMode">Güvenlik Modu</option>
    <option value="secLimits">Pompa/Isıtıcı Limitleri</option>
    <option value="secAlerts">Uyarı Eşikleri</option>
    <option value="secEnergy">Enerji Tarifesi</option>
    <option value="secLuxAutomation">Işık Otomasyonu (Lux)</option>
    <option value="secHeaterAutomation">Isıtıcı Otomasyonu</option>
    <option value="secPumpAutomation">Sulama Otomasyonu</option>
    <option value="secSoilCalibration">Toprak Kalibrasyonu</option>
    <option value="secFanAutomation">Fan Otomasyonu</option>
    <option value="secNotifications">Bildirimler</option>
    <option value="secRetention">Veri Saklama</option>
  </select>
  <div class="form-text">Uzun sayfada hızlı gezinmek için.</div>
</div></div>

<div class="card mt-3" id="secAlerts"><div class="card-body">
  <h6>Uyarı Eşikleri</h6>
  <div class="row g-2">
    <div class="col-md-3">
      <label class="form-label">Sensör Offline (dk)
        <span class="info-icon" data-bs-toggle="tooltip" title="Sensörden bu süre boyunca OK veri gelmezse uyarı üretir.">?</span>
      </label>
      <input class="form-control" id="alertOfflineMinutes" type="number" min="0" value="5">
      <div class="form-text">0 devre dışı</div>
    </div>
    <div class="col-md-3">
      <label class="form-label">Sıcaklık Yüksek (C)
        <span class="info-icon" data-bs-toggle="tooltip" title="Üst sınır aşıldığında uyarı üretir. 0 ise devre dışı.">?</span>
      </label>
      <input class="form-control" id="alertTempHigh" type="number" step="0.1" value="30">
      <div class="form-text">0 devre dışı</div>
    </div>
    <div class="col-md-3">
      <label class="form-label">Sıcaklık Düşük (C)
        <span class="info-icon" data-bs-toggle="tooltip" title="Alt sınır altına düşerse uyarı üretir. 0 ise devre dışı.">?</span>
      </label>
      <input class="form-control" id="alertTempLow" type="number" step="0.1" value="0">
      <div class="form-text">0 devre dışı</div>
    </div>
    <div class="col-md-3">
      <label class="form-label">Nem Yüksek (%)
        <span class="info-icon" data-bs-toggle="tooltip" title="Nem bu değerin üstüne çıkarsa uyarı üretir. 0 ise devre dışı.">?</span>
      </label>
      <input class="form-control" id="alertHumHigh" type="number" step="0.1" value="85">
      <div class="form-text">0 devre dışı</div>
    </div>
  </div>
  <div class="row g-2 mt-2">
    <div class="col-md-3">
      <label class="form-label">Nem Düşük (%)
        <span class="info-icon" data-bs-toggle="tooltip" title="Nem bu değerin altına düşerse uyarı üretir. 0 ise devre dışı.">?</span>
      </label>
      <input class="form-control" id="alertHumLow" type="number" step="0.1" value="0">
      <div class="form-text">0 devre dışı</div>
    </div>
  </div>
</div></div>

<div class="card mt-3" id="secEnergy"><div class="card-body">
  <h6>Enerji Tarifesi (TL/kWh)</h6>
  <div class="row g-2">
    <div class="col-md-4">
      <label class="form-label">Düşük Kademe
        <span class="info-icon" data-bs-toggle="tooltip" title="Belirlenen eşik kWh’a kadar uygulanacak birim fiyat.">?</span>
      </label>
      <input class="form-control" id="energyKwhLow" type="number" step="0.001" value="2.330">
    </div>
    <div class="col-md-4">
      <label class="form-label">Yüksek Kademe
        <span class="info-icon" data-bs-toggle="tooltip" title="Eşik kWh üstündeki tüketime uygulanacak birim fiyat.">?</span>
      </label>
      <input class="form-control" id="energyKwhHigh" type="number" step="0.001" value="3.451">
    </div>
    <div class="col-md-4">
      <label class="form-label">Kademe Eşiği (kWh)
        <span class="info-icon" data-bs-toggle="tooltip" title="Bu toplam kWh aşıldığında yüksek kademe fiyatı uygulanır.">?</span>
      </label>
      <input class="form-control" id="energyKwhThreshold" type="number" step="1" value="240">
    </div>
  </div>
  <div class="form-text">Toplam tüketim eşiği aştığında yüksek kademe uygulanır.</div>
</div></div>

<div class="card mt-3" id="secLuxAutomation"><div class="card-body">
  <h6>Işık Otomasyonu (Lux)</h6>
  <div class="row g-2">
    <div class="col-md-3">
      <label class="form-label">Durum
        <span class="info-icon" data-bs-toggle="tooltip" title="Lux otomasyonunu aç/kapat. Kapalıysa ışık otomasyonu çalışmaz.">?</span>
      </label>
      <select class="form-select" id="autoEnabled">
        <option value="false">Kapalı</option>
        <option value="true">Açık</option>
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">LUX_OK
        <span class="info-icon" data-bs-toggle="tooltip" title="Lux bu değerin üstündeyse ışık yeterli sayılır.">?</span>
      </label>
      <input class="form-control" id="luxOk" type="number" value="350">
    </div>
    <div class="col-md-3">
      <label class="form-label">LUX_MAX (opsiyonel)
        <span class="info-icon" data-bs-toggle="tooltip" title="Lux bu değeri geçerse otomasyon geçici olarak durur. 0 devre dışı.">?</span>
      </label>
      <input class="form-control" id="luxMax" type="number" value="0">
    </div>
    <div class="col-md-3">
      <label class="form-label">Hedef (dk)
        <span class="info-icon" data-bs-toggle="tooltip" title="Gün içinde lux hedefinin sağlanması gereken toplam dakika.">?</span>
      </label>
      <input class="form-control" id="targetMinutes" type="number" value="300">
    </div>
    <div class="col-md-3">
      <label class="form-label">Zaman Penceresi
        <span class="info-icon" data-bs-toggle="tooltip" title="Otomasyonun aktif olacağı saat aralığı. Geceyi kapsayabilir.">?</span>
      </label>
      <div class="d-flex gap-2">
        <input class="form-control" id="windowStart" type="time" value="06:00">
        <input class="form-control" id="windowEnd" type="time" value="22:00">
      </div>
    </div>
    <div class="col-md-3">
      <label class="form-label">Reset Saati
        <span class="info-icon" data-bs-toggle="tooltip" title="Günlük hedef sayacı bu saatte sıfırlanır.">?</span>
      </label>
      <input class="form-control" id="resetTime" type="time" value="00:00">
    </div>
  </div>
  <div class="row g-2 mt-2">
    <div class="col-md-3">
      <label class="form-label">Min Açık (dk)
        <span class="info-icon" data-bs-toggle="tooltip" title="Işık açıldıktan sonra en az bu kadar açık kalır.">?</span>
      </label>
      <input class="form-control" id="minOnMinutes" type="number" min="0" value="0">
    </div>
    <div class="col-md-3">
      <label class="form-label">Min Kapalı (dk)
        <span class="info-icon" data-bs-toggle="tooltip" title="Işık kapandıktan sonra en az bu kadar kapalı kalır.">?</span>
      </label>
      <input class="form-control" id="minOffMinutes" type="number" min="0" value="0">
    </div>
    <div class="col-md-3">
      <label class="form-label">Maks Blok (dk)
        <span class="info-icon" data-bs-toggle="tooltip" title="Sürekli çalışmayı önlemek için blok süresi. 0 devre dışı.">?</span>
      </label>
      <input class="form-control" id="maxBlockMinutes" type="number" min="0" value="0">
    </div>
    <div class="col-md-3">
      <label class="form-label">Manuel Müdahale (dk)
        <span class="info-icon" data-bs-toggle="tooltip" title="Manuel aç/kapat sonrası otomasyonun bekleyeceği süre.">?</span>
      </label>
      <input class="form-control" id="manualOverrideMinutes" type="number" min="0" value="0">
    </div>
  </div>
</div></div>

<div class="card mt-3" id="secHeaterAutomation"><div class="card-body">
  <h6>Isıtıcı Otomasyonu</h6>
  <div class="row g-2">
    <div class="col-md-3">
      <label class="form-label">Durum
        <span class="info-icon" data-bs-toggle="tooltip" title="Isıtıcı otomasyonunu aç/kapat. Kapalıysa sadece manuel kontrol edilir.">?</span>
      </label>
      <select class="form-select" id="heaterEnabled">
        <option value="false">Kapalı</option>
        <option value="true">Açık</option>
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">Sensör
        <span class="info-icon" data-bs-toggle="tooltip" title="Isıtıcı kontrolü için kullanılan sıcaklık sensörü.">?</span>
      </label>
      <select class="form-select" id="heaterSensor">
        <option value="dht22">DHT22</option>
        <option value="ds18b20">DS18B20</option>
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">T Low (C)
        <span class="info-icon" data-bs-toggle="tooltip" title="Bu sıcaklığın altına düşerse ısıtıcı devreye girer.">?</span>
      </label>
      <input class="form-control" id="heaterTLow" type="number" step="0.1" value="18">
    </div>
    <div class="col-md-3">
      <label class="form-label">T High (C)
        <span class="info-icon" data-bs-toggle="tooltip" title="Bu sıcaklığa gelince ısıtıcı kapanır.">?</span>
      </label>
      <input class="form-control" id="heaterTHigh" type="number" step="0.1" value="20">
    </div>
  </div>
  <div class="row g-2 mt-2">
    <div class="col-md-3">
      <label class="form-label">Max Çalışma (dk)
        <span class="info-icon" data-bs-toggle="tooltip" title="Isıtıcı bir seferde bu süreyi aşamaz.">?</span>
      </label>
      <input class="form-control" id="heaterMaxMinutes" type="number" min="0" value="5">
    </div>
    <div class="col-md-3">
      <label class="form-label">Min Kapalı (dk)
        <span class="info-icon" data-bs-toggle="tooltip" title="Isıtıcı kapandıktan sonra en az bu süre bekler.">?</span>
      </label>
      <input class="form-control" id="heaterMinOffMinutes" type="number" min="0" value="2">
    </div>
    <div class="col-md-3">
      <label class="form-label">Manuel Müdahale (dk)
        <span class="info-icon" data-bs-toggle="tooltip" title="Manuel müdahaleden sonra otomasyonun bekleyeceği süre.">?</span>
      </label>
      <input class="form-control" id="heaterManualOverrideMinutes" type="number" min="0" value="10">
    </div>
    <div class="col-md-3">
      <label class="form-label">Fan Zorunlu
        <span class="info-icon" data-bs-toggle="tooltip" title="Isıtıcı çalışırken fanın açık olmasını şart koşar.">?</span>
      </label>
      <select class="form-select" id="heaterFanRequired">
        <option value="true">Açık</option>
        <option value="false">Kapalı</option>
      </select>
    </div>
  </div>
  <div class="row g-2 mt-2">
    <div class="col-md-3">
      <label class="form-label">Gece Modu
        <span class="info-icon" data-bs-toggle="tooltip" title="Gece için ayrı sıcaklık aralığı uygular.">?</span>
      </label>
      <select class="form-select" id="heaterNightEnabled">
        <option value="false">Kapalı</option>
        <option value="true">Açık</option>
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">Gece Penceresi
        <span class="info-icon" data-bs-toggle="tooltip" title="Gece modunun geçerli olduğu saat aralığı.">?</span>
      </label>
      <div class="d-flex gap-2">
        <input class="form-control" id="heaterNightStart" type="time" value="22:00">
        <input class="form-control" id="heaterNightEnd" type="time" value="06:00">
      </div>
    </div>
    <div class="col-md-3">
      <label class="form-label">Gece T Low (C)
        <span class="info-icon" data-bs-toggle="tooltip" title="Gece için alt sıcaklık eşiği.">?</span>
      </label>
      <input class="form-control" id="heaterNightTLow" type="number" step="0.1" value="17">
    </div>
    <div class="col-md-3">
      <label class="form-label">Gece T High (C)
        <span class="info-icon" data-bs-toggle="tooltip" title="Gece için üst sıcaklık eşiği.">?</span>
      </label>
      <input class="form-control" id="heaterNightTHigh" type="number" step="0.1" value="19">
    </div>
  </div>
</div></div>

<div class="card mt-3" id="secPumpAutomation"><div class="card-body">
  <h6>Sulama Otomasyonu</h6>
  <div class="row g-2">
    <div class="col-md-3">
      <label class="form-label">Durum
        <span class="info-icon" data-bs-toggle="tooltip" title="Pompa otomasyonunu aç/kapat. Kapalıysa sadece manuel çalışır.">?</span>
      </label>
      <select class="form-select" id="pumpEnabled">
        <option value="false">Kapalı</option>
        <option value="true">Açık</option>
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">Toprak Sensörü
        <span class="info-icon" data-bs-toggle="tooltip" title="Pompanın karar vereceği toprak kanalını seç.">?</span>
      </label>
      <select class="form-select" id="pumpSoilChannel">
        <option value="ch0">CH0</option>
        <option value="ch1">CH1</option>
        <option value="ch2">CH2</option>
        <option value="ch3">CH3</option>
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">Kuru Eşiği (raw)
        <span class="info-icon" data-bs-toggle="tooltip" title="Toprak ham değeri bu eşiğe göre kuru kabul edilir. 0 ise devre dışı.">?</span>
      </label>
      <input class="form-control" id="pumpDryThreshold" type="number" value="0">
      <div class="form-text">0 devre dışı</div>
    </div>
    <div class="col-md-3">
      <label class="form-label">Kuru Yönü
        <span class="info-icon" data-bs-toggle="tooltip" title="Sensör değeri düşükse mi yüksekse mi kuru sayılacağını belirler.">?</span>
      </label>
      <select class="form-select" id="pumpDryWhenAbove">
        <option value="false">Değer düşükse kuru</option>
        <option value="true">Değer yüksekse kuru</option>
      </select>
    </div>
  </div>
  <div class="row g-2 mt-2">
    <div class="col-md-3">
      <label class="form-label">Darbe Süresi (sn)
        <span class="info-icon" data-bs-toggle="tooltip" title="Pompanın tek seferde çalışacağı süre.">?</span>
      </label>
      <input class="form-control" id="pumpPulseSeconds" type="number" min="1" value="5">
    </div>
    <div class="col-md-3">
      <label class="form-label">Max Günlük (sn)
        <span class="info-icon" data-bs-toggle="tooltip" title="Gün içinde pompanın toplam çalışma süresi limiti.">?</span>
      </label>
      <input class="form-control" id="pumpMaxDailySeconds" type="number" min="0" value="60">
    </div>
    <div class="col-md-3">
      <label class="form-label">Zaman Penceresi
        <span class="info-icon" data-bs-toggle="tooltip" title="Pompa otomasyonunun aktif olacağı saat aralığı.">?</span>
      </label>
      <div class="d-flex gap-2">
        <input class="form-control" id="pumpWindowStart" type="time" value="06:00">
        <input class="form-control" id="pumpWindowEnd" type="time" value="22:00">
      </div>
    </div>
    <div class="col-md-3">
      <label class="form-label">Manuel Müdahale (dk)
        <span class="info-icon" data-bs-toggle="tooltip" title="Manuel sulamadan sonra otomasyonun bekleyeceği süre.">?</span>
      </label>
      <input class="form-control" id="pumpManualOverrideMinutes" type="number" min="0" value="10">
    </div>
  </div>
</div></div>

<div class="card mt-3" id="secSoilCalibration"><div class="card-body">
  <h6>Toprak Kalibrasyonu</h6>
  <div class="table-responsive">
    <table class="table table-sm align-middle mb-0">
      <thead>
        <tr>
          <th>Kanal</th>
          <th>Kuru</th>
          <th>Islak</th>
          <th>Şimdi Al</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>CH0</td>
          <td><input class="form-control form-control-sm" id="calDryCh0" type="number"></td>
          <td><input class="form-control form-control-sm" id="calWetCh0" type="number"></td>
          <td>
            <div class="d-flex gap-1">
              <button class="btn btn-outline-secondary btn-sm" data-cal-channel="ch0" data-cal-type="dry">Kuru</button>
              <button class="btn btn-outline-secondary btn-sm" data-cal-channel="ch0" data-cal-type="wet">Islak</button>
            </div>
          </td>
        </tr>
        <tr>
          <td>CH1</td>
          <td><input class="form-control form-control-sm" id="calDryCh1" type="number"></td>
          <td><input class="form-control form-control-sm" id="calWetCh1" type="number"></td>
          <td>
            <div class="d-flex gap-1">
              <button class="btn btn-outline-secondary btn-sm" data-cal-channel="ch1" data-cal-type="dry">Kuru</button>
              <button class="btn btn-outline-secondary btn-sm" data-cal-channel="ch1" data-cal-type="wet">Islak</button>
            </div>
          </td>
        </tr>
        <tr>
          <td>CH2</td>
          <td><input class="form-control form-control-sm" id="calDryCh2" type="number"></td>
          <td><input class="form-control form-control-sm" id="calWetCh2" type="number"></td>
          <td>
            <div class="d-flex gap-1">
              <button class="btn btn-outline-secondary btn-sm" data-cal-channel="ch2" data-cal-type="dry">Kuru</button>
              <button class="btn btn-outline-secondary btn-sm" data-cal-channel="ch2" data-cal-type="wet">Islak</button>
            </div>
          </td>
        </tr>
        <tr>
          <td>CH3</td>
          <td><input class="form-control form-control-sm" id="calDryCh3" type="number"></td>
          <td><input class="form-control form-control-sm" id="calWetCh3" type="number"></td>
          <td>
            <div class="d-flex gap-1">
              <button class="btn btn-outline-secondary btn-sm" data-cal-channel="ch3" data-cal-type="dry">Kuru</button>
              <button class="btn btn-outline-secondary btn-sm" data-cal-channel="ch3" data-cal-type="wet">Islak</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="form-text">Kuru: sensör havada. Islak: suya/çok ıslak toprağa batır.</div>
</div></div>

<div class="card mt-3" id="secFanAutomation"><div class="card-body">
  <h6>Fan Otomasyonu</h6>
  <div class="row g-2">
    <div class="col-md-3">
      <label class="form-label">Durum
        <span class="info-icon" data-bs-toggle="tooltip" title="Fan otomasyonunu aç/kapat.">?</span>
      </label>
      <select class="form-select" id="fanEnabled">
        <option value="false">Kapalı</option>
        <option value="true">Açık</option>
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">RH High (%)
        <span class="info-icon" data-bs-toggle="tooltip" title="Nem bu değerin üstüne çıkınca fan açılır.">?</span>
      </label>
      <input class="form-control" id="fanRhHigh" type="number" value="80">
    </div>
    <div class="col-md-3">
      <label class="form-label">RH Low (%)
        <span class="info-icon" data-bs-toggle="tooltip" title="Nem bu değerin altına düşünce fan kapanır.">?</span>
      </label>
      <input class="form-control" id="fanRhLow" type="number" value="70">
    </div>
    <div class="col-md-3">
      <label class="form-label">Max Çalışma (dk)
        <span class="info-icon" data-bs-toggle="tooltip" title="Fan bir seferde bu süreyi aşamaz.">?</span>
      </label>
      <input class="form-control" id="fanMaxMinutes" type="number" min="0" value="3">
    </div>
  </div>
  <div class="row g-2 mt-2">
    <div class="col-md-3">
      <label class="form-label">Min Kapalı (dk)
        <span class="info-icon" data-bs-toggle="tooltip" title="Fan kapandıktan sonra en az bu süre bekler.">?</span>
      </label>
      <input class="form-control" id="fanMinOffMinutes" type="number" min="0" value="2">
    </div>
    <div class="col-md-3">
      <label class="form-label">Manuel Müdahale (dk)
        <span class="info-icon" data-bs-toggle="tooltip" title="Manuel müdahaleden sonra otomasyonun bekleyeceği süre.">?</span>
      </label>
      <input class="form-control" id="fanManualOverrideMinutes" type="number" min="0" value="10">
    </div>
    <div class="col-md-3">
      <label class="form-label">Gece Modu
        <span class="info-icon" data-bs-toggle="tooltip" title="Gece saatlerinde farklı nem eşikleri uygular.">?</span>
      </label>
      <select class="form-select" id="fanNightEnabled">
        <option value="false">Kapalı</option>
        <option value="true">Açık</option>
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">Gece Penceresi
        <span class="info-icon" data-bs-toggle="tooltip" title="Gece modunun geçerli olduğu saat aralığı.">?</span>
      </label>
      <div class="d-flex gap-2">
        <input class="form-control" id="fanNightStart" type="time" value="22:00">
        <input class="form-control" id="fanNightEnd" type="time" value="06:00">
      </div>
    </div>
  </div>
  <div class="row g-2 mt-2">
    <div class="col-md-3">
      <label class="form-label">Gece RH High (%)
        <span class="info-icon" data-bs-toggle="tooltip" title="Gece için yüksek nem eşiği.">?</span>
      </label>
      <input class="form-control" id="fanNightRhHigh" type="number" value="85">
    </div>
    <div class="col-md-3">
      <label class="form-label">Gece RH Low (%)
        <span class="info-icon" data-bs-toggle="tooltip" title="Gece için düşük nem eşiği.">?</span>
      </label>
      <input class="form-control" id="fanNightRhLow" type="number" value="75">
    </div>
  </div>
  <div class="row g-2 mt-2">
    <div class="col-md-3">
      <label class="form-label">Periyodik Mod
        <span class="info-icon" data-bs-toggle="tooltip" title="Nemden bağımsız periyodik çalıştırma.">?</span>
      </label>
      <select class="form-select" id="fanPeriodicEnabled">
        <option value="false">Kapalı</option>
        <option value="true">Açık</option>
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">Her (dk)
        <span class="info-icon" data-bs-toggle="tooltip" title="Periyodik çalışma aralığı.">?</span>
      </label>
      <input class="form-control" id="fanPeriodicEvery" type="number" min="1" value="60">
    </div>
    <div class="col-md-3">
      <label class="form-label">Süre (dk)
        <span class="info-icon" data-bs-toggle="tooltip" title="Periyodik çalışmanın süresi.">?</span>
      </label>
      <input class="form-control" id="fanPeriodicDuration" type="number" min="1" value="2">
    </div>
    <div class="col-md-3">
      <label class="form-label">Gece Periyodik
        <span class="info-icon" data-bs-toggle="tooltip" title="Gece için ayrı periyodik çalıştırma ayarı.">?</span>
      </label>
      <select class="form-select" id="fanPeriodicNightEnabled">
        <option value="false">Kapalı</option>
        <option value="true">Açık</option>
      </select>
    </div>
  </div>
  <div class="row g-2 mt-2">
    <div class="col-md-3">
      <label class="form-label">Gece Her (dk)
        <span class="info-icon" data-bs-toggle="tooltip" title="Gece periyodik çalışma aralığı.">?</span>
      </label>
      <input class="form-control" id="fanPeriodicNightEvery" type="number" min="1" value="90">
    </div>
    <div class="col-md-3">
      <label class="form-label">Gece Süre (dk)
        <span class="info-icon" data-bs-toggle="tooltip" title="Gece periyodik çalışmanın süresi.">?</span>
      </label>
      <input class="form-control" id="fanPeriodicNightDuration" type="number" min="1" value="2">
    </div>
    <div class="col-md-6 d-flex align-items-end">
      <p class="text-secondary small mb-0">Gece penceresi fan ayarlarındaki "Gece Penceresi" ile aynıdır.</p>
    </div>
  </div>
</div></div>

<div class="card mt-3" id="secNotifications"><div class="card-body">
  <h6>Bildirimler</h6>
  <p class="text-secondary small mb-2">
    Uyarı ve hataları Telegram’a gönderebilir. Tokenlar config içinde tutulmaz; env var ile verilir: <code>TELEGRAM_BOT_TOKEN</code>, <code>TELEGRAM_CHAT_ID</code>.
  </p>
  <div class="row g-2 align-items-end">
    <div class="col-md-3">
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" role="switch" id="notifyEnabled">
        <label class="form-check-label" for="notifyEnabled">Bildirimler aktif</label>
      </div>
    </div>
    <div class="col-md-3">
      <label class="form-label">Seviye
        <span class="info-icon" data-bs-toggle="tooltip" title="Bu seviyenin altındaki uyarılar gönderilmez. Örn: warning seçilirse info gönderilmez.">?</span>
      </label>
      <select class="form-select" id="notifyLevel">
        <option value="debug">debug</option>
        <option value="info">info</option>
        <option value="warning">warning</option>
        <option value="error">error</option>
      </select>
    </div>
    <div class="col-md-3">
      <label class="form-label">Cooldown (s)
        <span class="info-icon" data-bs-toggle="tooltip" title="Aynı anda çok fazla mesaj gitmesini önlemek için minimum bekleme süresi. 0 = sınırsız.">?</span>
      </label>
      <input class="form-control" id="notifyCooldown" type="number" min="0" value="300">
    </div>
    <div class="col-md-3">
      <small class="text-secondary d-block">Telegram yapılandırma</small>
      <span class="pill" id="telegramConfigStatus">--</span>
    </div>
  </div>
  <div class="row g-2 mt-2">
    <div class="col-md-3">
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" role="switch" id="notifyTelegramEnabled">
        <label class="form-check-label" for="notifyTelegramEnabled">Telegram aktif</label>
      </div>
    </div>
    <div class="col-md-3">
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" role="switch" id="notifyAllowSimulation">
        <label class="form-check-label" for="notifyAllowSimulation">Simülasyonda da gönder</label>
      </div>
      <div class="form-text">SIMULATION_MODE’da test bildirimi atabilir.</div>
    </div>
    <div class="col-md-3">
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" role="switch" id="notifyEmailEnabled" disabled>
        <label class="form-check-label" for="notifyEmailEnabled">Email (yakında)</label>
      </div>
    </div>
  </div>
  <div class="row g-2 mt-2 align-items-end">
    <div class="col-md-8">
      <label class="form-label">Test Mesajı</label>
      <input class="form-control" id="notifyTestMessage" type="text" placeholder="İsteğe bağlı mesaj">
      <small class="text-secondary" id="notifyTestResult"></small>
    </div>
    <div class="col-md-4">
      <button class="btn btn-outline-secondary w-100" id="testNotificationBtn" type="button">Test Bildirimi Gönder</button>
    </div>
  </div>
</div></div>

<div class="card mt-3" id="secRetention"><div class="card-body">
  <h6>Veri Saklama</h6>
  <p class="text-secondary small mb-2">
    <strong>0 gün</strong> = silme kapalı. Dikkat: silme geri alınamaz; istersen önce arşivi aç.
  </p>
  <div class="row g-2">
    <div class="col-md-3">
      <label class="form-label">Sensör kayıt (gün)</label>
      <input class="form-control" id="retentionSensorDays" type="number" min="0" value="0">
    </div>
    <div class="col-md-3">
      <label class="form-label">Olay kayıt (gün)</label>
      <input class="form-control" id="retentionEventDays" type="number" min="0" value="0">
    </div>
    <div class="col-md-3">
      <label class="form-label">Aktüatör kayıt (gün)</label>
      <input class="form-control" id="retentionActuatorDays" type="number" min="0" value="0">
    </div>
    <div class="col-md-3">
      <label class="form-label">Temizlik aralığı (saat)</label>
      <input class="form-control" id="retentionIntervalHours" type="number" min="1" value="24">
    </div>
  </div>
  <div class="row g-2 mt-2 align-items-end">
    <div class="col-md-3">
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" role="switch" id="retentionArchiveEnabled">
        <label class="form-check-label" for="retentionArchiveEnabled">Arşiv açık</label>
      </div>
    </div>
    <div class="col-md-6">
      <label class="form-label">Arşiv klasörü</label>
      <input class="form-control" id="retentionArchiveDir" type="text" value="data/archives">
      <div class="form-text">Repo içinde bir klasör ver (örn: <code>data/archives</code>).</div>
    </div>
    <div class="col-md-3">
      <small class="text-secondary d-block">Son temizlik</small>
      <span class="pill" id="retentionLastCleanup">--</span>
    </div>
  </div>
  <div class="row g-2 mt-2 align-items-end">
    <div class="col-md-8">
      <small class="text-secondary" id="retentionCleanupResult"></small>
    </div>
    <div class="col-md-4">
      <button class="btn btn-outline-secondary w-100" id="runRetentionCleanupBtn" type="button">Temizliği Şimdi Çalıştır</button>
    </div>
  </div>
</div></div>

<div class="d-flex justify-content-between align-items-center mt-3 mb-3 d-md-none">
  <small class="text-secondary" id="settingsSavedNoteBottom"></small>
  <button class="btn btn-primary" id="saveSettingsBottom" type="button">Kaydet</button>
</div>

<script>window.initSettings && window.initSettings();</script>
{% endblock %}
